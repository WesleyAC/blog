<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Wesley Aptekar-Cassels | Intro to Control Theory Part 3: Simulation</title>
  <meta name="description" content="Find a mathematical model for our example elevator">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preload" href="/fonts/Harriet-v2-Text-Regular-latin1.woff2" as="font" type="font/woff2">
  <link rel="preload" href="/fonts/Harriet-v2-Text-Regular-Italic-latin1.woff2" as="font" type="font/woff2">
  <link rel="preload" href="/fonts/Harriet-v2-Text-Bold-latin1.woff2" as="font" type="font/woff2">
  <link rel="preload" href="/fonts/LatoLatin-Regular.woff2" as="font" type="font/woff2">

  <meta property="og:title" content="Intro to Control Theory Part 3: Simulation">
  <meta property="og:type" content="website">
  <meta property="og:url" content="/posts/intro-to-control-part-three-simulation">
  <meta property="og:description" content="Find a mathematical model for our example elevator">
  <meta property="og:site_name" content="Wesley Aptekar-Cassels">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="/posts/intro-to-control-part-three-simulation">
  <meta name="twitter:title" content="Intro to Control Theory Part 3: Simulation">
  <meta name="twitter:description" content="Find a mathematical model for our example elevator">

  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="Wesley Aptekar-Cassels Last 10 blog posts" />

  <link type="text/css" rel="stylesheet" href="/light.css">
  <link type="text/css" rel="stylesheet" href="/dark.css">
</head>

<body>
  <main>
    <nav class="header-nav">
  <a href="/" class="header-logo" title="Wesley Aptekar-Cassels">Wesley Aptekar-Cassels</a>
  <div class="header-links">
    <a href="/feed.xml" target="_blank" title="RSS">
      <div style="width:16px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M56 336c31 0 56 25 56 56s-25 56-56 56-56-25-56-56 25-56 56-56zM0 192c140 0 256 116 256 256h-80c0-48-14-94-48-128S48 272 0 272v-80zM0 64c212 0 384 172 384 384h-80c0-171-133-304-304-304V64z"/></svg></div>
    </a>
    <a href="mailto:me@wesleyac.com" target="_blank" title="Email">
      <div style="width:18px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M422 407c-24 25-52 43-85 55s-69 18-105 18c-35 0-66-6-95-17s-53-26-73-46-36-43-47-71-17-58-17-90 6-62 18-89 29-51 50-71 46-35 74-47c28-11 58-17 90-17 28 0 55 4 81 12s49 20 69 36 36 36 48 60 18 53 18 85c0 24-3 46-10 64s-16 34-27 46-24 22-38 28-29 10-45 10-29-4-39-12-15-17-15-29h-3c-6 10-15 19-28 28s-28 13-46 13c-28 0-49-9-64-27s-23-42-23-71c0-17 3-34 9-50s14-31 24-44 23-23 38-31 31-12 49-12c15 0 27 4 38 10 10 6 18 15 21 24h1l5-24h54l-24 113c-1 6-2 12-3 19s-2 13-2 19c0 7 1 13 4 18s7 7 15 7c16 0 29-9 39-26s16-40 16-68c0-24-4-45-12-64s-20-34-34-47-32-23-52-29-41-9-65-9c-26 0-49 4-70 13s-39 22-54 38-27 34-35 56c-8 21-13 44-13 69 0 26 4 51 13 72s21 39 37 54 35 27 57 35 46 12 72 12c33 0 61-6 85-16s45-25 65-43zM231 188c-10 0-18 2-25 8s-14 13-19 22-8 18-11 28-4 20-4 30c0 5 0 10 1 16 1 5 3 10 6 15s7 8 12 11 11 5 19 5c11 0 20-3 28-8s14-13 19-21 9-16 11-26 3-19 3-27c0-6 0-13-1-19s-4-12-7-17-7-9-12-12-12-5-20-5z"/></svg></div>
    </a>
    <a href="https://github.com/WesleyAC" target="_blank" title="GitHub">
      <div style="width:18px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 32c124 0 224 103 224 230 0 101-64 188-153 218h-4c-8 0-12-7-12-12 0-8 1-31 1-62 0-21-8-36-16-43 50-6 103-25 103-113 0-25-9-46-23-62 2-6 10-29-2-61h-5c-8 0-27 3-57 24-18-5-37-8-56-8s-38 3-56 8c-30-21-49-24-57-24h-5c-12 32-4 55-2 61-14 16-23 37-23 62 0 88 52 107 102 113-6 6-12 16-14 31-6 3-16 6-26 6-13 0-28-5-39-25 0 0-13-22-35-24-2 0-21 0-1 14 0 0 15 8 25 34 0 0 10 33 53 33 7 0 14 0 22-2v39c0 5-3 11-11 11h-4C64 450 0 364 0 262 0 135 100 32 224 32z"/></svg></div>
    </a>
  </div>
</nav>

    <article>
      <header class="article-header">
        <h1>Intro to Control Theory Part 3: Simulation</h1>
        <div class="article-list-date">
          Dec 29, 2016
        </div>
      </header>

      <div class="article-content">
        <p><em>Note: This post will assume some prior knowledge of physics. If you&#39;ve taken a high school level physics class, you should be fine. If not, be prepared to do a bit of Googling :)</em></p>

<p>Say you&#39;re developing a control system for a self-driving car, or a airplane (or almost anything). You want to be really, <em>really</em> sure that when you try it out for the first time, it&#39;ll work. How do you make sure that that&#39;s the case?</p>

<p>The simple answer is to test all of your code in simulation before it ever touches actual hardware.  Test driven development is catching on in pretty much every major company, because people have learned that testing saves time and money - even if you&#39;re just writing an app or a website. So when running the wrong code results in breaking physical machinery that can cost hundreds or thousands of dollars, it makes even more sense to test in simulation. But how do you go about testing your controls code?</p>

<p>There are basically two steps:</p>

<ol>
<li>Create a model of your system</li>
<li>Run your code on that model</li>
</ol>

<p>It can be hard to know where to start on modeling your system though. Because of that, we&#39;ll go through the process of modeling simple elevator from <a href="/posts/intro-to-control-part-one-pid">Part 1</a>.</p>

<p>Let&#39;s get right into it!</p>

<p>This is the simulation from part one - this is rather easy to model, since it isn&#39;t designed to model a real system - I got to decide exactly what it would be. Still, I decided to make it a reasonable system that modeled something that you might see in the real world:</p>

<ul>
<li>It had a mass of 100 kg</li>
<li>Friction causes it to be dampened by 10 Ns/m.</li>
<li>The input was a direct force on the elevator, ranging from -5000 Newtons to 5000 Newtons (This was normalized to -1.0 to 1.0 in the code)</li>
<li>Gravity is 9.8 \(m/s^2\)</li>
</ul>

<p>First, let&#39;s make a <a href="https://en.wikipedia.org/wiki/Free_body_diagram">free body diagram</a> to help understand the situation! Here&#39;s a FBD for full force upwards, applying no force, and full force downwards:</p>

<p><img src="../img/control3/fbd.jpg" alt="Free body diagram"></p>

<p>Here, \(F_{g}\) is the force of gravity, \(F_{c}\) is the control force that we are applying, and \(F_{f}\) is the force due to friction. I will use \( m \) as the mass of the elevator. Using these numbers, we can describe the system with the following equation:</p>

<p>\[ \ddot{x} = \frac{F_{c}}{m} - F_{f} - A_{g} \]</p>

<p>Here, \(\ddot{x}\) is the second derivative of the elevator&#39;s position, also known as it&#39;s acceleration. We use \(A_{g}\) to describe the acceleration due to gravity.</p>

<p>We get the \(\frac{F_{c}}{m}\) from the equation \(\text{Force} = \text{Mass} \times \text{Acceleration}\), or \(F = ma\), which we rearrange as \(a = \frac{F}{m}\).</p>

<p>Next, we&#39;ll figure out what effect friction has.</p>

<p>\[ \ddot{x} = \frac{F_{c}}{m} - \frac{d}{m} \times \dot{x} - A_{g} \]</p>

<p>In this case, \( d \) is the &quot;damping coefficent&quot; - The 10 Ns/m in our list above.</p>

<p>We can replace these with the actual constants, getting the equation:</p>

<p>\[ \ddot{x} = \frac{F_{c}}{100\text{kg}} - \frac{10\text{Ns/m}}{100\text{kg}} \times \dot{x} - 9.8\text{m}/\text{s}^2 \]</p>

<p>\(F_{c}\) is more frequently called \(u\), which can give us:</p>

<p>\[ \ddot{x} = \frac{u}{100\text{kg}} - \frac{10\text{Ns/m}}{100\text{kg}} \times \dot{x} - 9.8\text{m}/\text{s}^2 \]</p>

<p>Thus we can simulate our elevator&#39;s acceleration (and thus it&#39;s velocity and position as well) with that equation. This equation is often called a <em>second-order differential equation</em>, becaues it has a second derivative in it (the \(\ddot{x}\), or acceleration).</p>

<p>We can easily translate this into code as well:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">setForce</span><span class="p">(</span><span class="nx">force</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">elevator</span><span class="p">.</span><span class="nx">xddot</span> <span class="o">=</span> <span class="p">(</span><span class="nx">force</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">elevator</span><span class="p">.</span><span class="nx">mass</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">elevator</span><span class="p">.</span><span class="nx">ff</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">elevator</span><span class="p">.</span><span class="nx">mass</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">elevator</span><span class="p">.</span><span class="nx">xdot</span><span class="p">)</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">elevator</span><span class="p">.</span><span class="nx">fg</span><span class="p">;</span>
<span class="p">},</span>
</code></pre></div>
<p>This is exactly the code that was used in the previous two posts to do the simulation!</p>

<p>Now, we can write a function to run PID control, and use that same function to first test it in our simulation, and then run the actual system.</p>

      </div>

      <br>
      <!--
ooops, coronavirus happened, guess we're not doing this anymore :(
hopefully someday...
<p>If you're in NYC and want to meet up over lunch/coffee to chat about the future of technology, <a href="mailto:me@wesleyac.com">get in touch with me</a>.</p>
-->

      <br>
    </article>
  </main>
  <script async src="/mathjax/MathJax.js?config=TeX-MML-AM_CHTML"></script> 
</body>
</html>
