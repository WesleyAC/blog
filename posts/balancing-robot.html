<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Wesley Aptekar-Cassels | Balancing Robot</title>
  <meta name="description" content="Lessons learned from making a robot">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preload" href="/fonts/Harriet-v2-Text-Regular-latin1.woff2" as="font" type="font/woff2">
  <link rel="preload" href="/fonts/Harriet-v2-Text-Regular-Italic-latin1.woff2" as="font" type="font/woff2">
  <link rel="preload" href="/fonts/Harriet-v2-Text-Bold-latin1.woff2" as="font" type="font/woff2">
  <link rel="preload" href="/fonts/LatoLatin-Regular.woff2" as="font" type="font/woff2">

  <meta property="og:title" content="Balancing Robot">
  <meta property="og:type" content="website">
  <meta property="og:url" content="/posts/balancing-robot">
  <meta property="og:description" content="Lessons learned from making a robot">
  <meta property="og:site_name" content="Wesley Aptekar-Cassels">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="/posts/balancing-robot">
  <meta name="twitter:title" content="Balancing Robot">
  <meta name="twitter:description" content="Lessons learned from making a robot">

  <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="Wesley Aptekar-Cassels Last 10 blog posts" />

  <link type="text/css" rel="stylesheet" href="/light.css">
  <link type="text/css" rel="stylesheet" href="/dark.css">
</head>

<body>
  <main>
    <nav class="header-nav">
  <a href="/" class="header-logo" title="Wesley Aptekar-Cassels">Wesley Aptekar-Cassels</a>
  <div class="header-links">
    <a href="/feed.xml" target="_blank" title="RSS">
      <div style="width:16px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M56 336c31 0 56 25 56 56s-25 56-56 56-56-25-56-56 25-56 56-56zM0 192c140 0 256 116 256 256h-80c0-48-14-94-48-128S48 272 0 272v-80zM0 64c212 0 384 172 384 384h-80c0-171-133-304-304-304V64z"/></svg></div>
    </a>
    <a href="mailto:me@wesleyac.com" target="_blank" title="Email">
      <div style="width:18px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M422 407c-24 25-52 43-85 55s-69 18-105 18c-35 0-66-6-95-17s-53-26-73-46-36-43-47-71-17-58-17-90 6-62 18-89 29-51 50-71 46-35 74-47c28-11 58-17 90-17 28 0 55 4 81 12s49 20 69 36 36 36 48 60 18 53 18 85c0 24-3 46-10 64s-16 34-27 46-24 22-38 28-29 10-45 10-29-4-39-12-15-17-15-29h-3c-6 10-15 19-28 28s-28 13-46 13c-28 0-49-9-64-27s-23-42-23-71c0-17 3-34 9-50s14-31 24-44 23-23 38-31 31-12 49-12c15 0 27 4 38 10 10 6 18 15 21 24h1l5-24h54l-24 113c-1 6-2 12-3 19s-2 13-2 19c0 7 1 13 4 18s7 7 15 7c16 0 29-9 39-26s16-40 16-68c0-24-4-45-12-64s-20-34-34-47-32-23-52-29-41-9-65-9c-26 0-49 4-70 13s-39 22-54 38-27 34-35 56c-8 21-13 44-13 69 0 26 4 51 13 72s21 39 37 54 35 27 57 35 46 12 72 12c33 0 61-6 85-16s45-25 65-43zM231 188c-10 0-18 2-25 8s-14 13-19 22-8 18-11 28-4 20-4 30c0 5 0 10 1 16 1 5 3 10 6 15s7 8 12 11 11 5 19 5c11 0 20-3 28-8s14-13 19-21 9-16 11-26 3-19 3-27c0-6 0-13-1-19s-4-12-7-17-7-9-12-12-12-5-20-5z"/></svg></div>
    </a>
    <a href="https://github.com/WesleyAC" target="_blank" title="GitHub">
      <div style="width:18px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 32c124 0 224 103 224 230 0 101-64 188-153 218h-4c-8 0-12-7-12-12 0-8 1-31 1-62 0-21-8-36-16-43 50-6 103-25 103-113 0-25-9-46-23-62 2-6 10-29-2-61h-5c-8 0-27 3-57 24-18-5-37-8-56-8s-38 3-56 8c-30-21-49-24-57-24h-5c-12 32-4 55-2 61-14 16-23 37-23 62 0 88 52 107 102 113-6 6-12 16-14 31-6 3-16 6-26 6-13 0-28-5-39-25 0 0-13-22-35-24-2 0-21 0-1 14 0 0 15 8 25 34 0 0 10 33 53 33 7 0 14 0 22-2v39c0 5-3 11-11 11h-4C64 450 0 364 0 262 0 135 100 32 224 32z"/></svg></div>
    </a>
  </div>
</nav>

    <article>
      <header class="article-header">
        <h1>Balancing Robot</h1>
        <div class="article-list-date">
          Jul 22, 2017
        </div>
      </header>

      <div class="article-content">
        <p>This week, I decided to build a robot:</p>

<p><img src="../img/robot1/bot.gif" alt="My robot"></p>

<p>It went pretty well, but there were definitely some things that I&#39;d do differently if I were to do it again. This post will cover the full mechanical/electrical/programming details of the robot, as well as talking about improvements for the future.</p>

<p>Let&#39;s get right into the details - here&#39;s the full list of parts that I used:</p>

<ul>
<li>Arduino UNO</li>
<li>Arduino Motor Shield</li>
<li>Pololu micro gearmotors</li>
<li>MPU6050 6-axis gyro+accelerometer</li>
<li>9v battery</li>
<li>Decoupling capacitor</li>
<li>Laser cut acrylic body</li>
<li>Wheels</li>
</ul>

<h1>Build process</h1>

<p>The first part of the build process was sourcing components - almost all of the components were scavenged from the electronics shelf at the <a href="https://www.recurse.com/">Recurse Center</a>, but there were still a few things lacking: a sensor to measure the angle, and a body to put all of the components on.</p>

<p>For the sensor, I chose the <a href="http://playground.arduino.cc/Main/MPU-6050">MPU6050</a>. It&#39;s a cheap 6-axis accelerometer+gyro. It also allows running code to estimate orientation on the MPU6050 chip itself, so that the arduino (or other processor) doesn&#39;t have to run the calculations for that. Unfortunately, the manufacturer doesn&#39;t provide much documentation for this - there is however a reverse-engineered <a href="https://www.i2cdevlib.com/devices/mpu6050">open source implementation</a> that works reasonably well.</p>

<p>Next, I needed some sort of base to attach the electronics and motors to. For this, I chose to laser cut acrylic. I used 3mm acrylic (the thinnest that I felt I could get away with). I was very happy with the speed and accuracy of laser cutting acrylic. It is slightly more brittle than I would like, but for this application it was fine, and it will definitely be my go to for small parts in the future.</p>

<h1>Electronics</h1>

<p>The Arduino received power through a 9v battery plugged into the motor shield. I used a <a href="https://en.wikipedia.org/wiki/Decoupling_capacitor">decoupling capacitor</a> across the leads of the battery to reduce noise that might effect the IMU. This was not an ideal setup, as the voltage drop in the battery caused significant differences in the response of the controller as the battery died.</p>

<p>The Motor Shield was also not an ideal solution - with the motors I was using, there was about a 15% deadzone where PWM was being applied but the motors did not move. This is a significant problem for a balancing robot, since it means that the only stable controller will have significant oscillations. I think switching to a better motor controller would help with this, and possibly better motors as well.</p>

<p>The setup for the IMU was fairly simple - it communicates over <a href="https://en.wikipedia.org/wiki/I%C2%B2C">I2C</a>, which is easy to set up. However, I did experience problems with significant oscillations causing the reading to drift. There are several things that I could think of that could cause this:</p>

<ul>
<li>The acceleration during the oscillations could be too much for the IMU to measure, causing drift.</li>
<li>The current draw from the motors could be causing interference with the IMU (This hunch is why I added the filtering capacitor).</li>
<li>There could be a bug in the motion processing firmware on the device. Sadly, it is closed source, so it would be very difficult to verify this.</li>
</ul>

<p>Overall, the electrical system on the robot was the part that could use the most work - many of the components that I chose I chose because they were easily available or cheap, and not based on how suited for the job they were.</p>

<h1>Programming</h1>

<p>The first step in programming the robot was to determine the orientation of the robot based off the readings from the accelerometer and gyroscope. I used the built in motion processing tools to do this, although I could have used the raw values and a <a href="https://en.wikipedia.org/wiki/Kalman_filter">Kalman Filter</a> to get similar results.</p>

<p>Once I knew the angle, I found the offset that the robot would need to be able to be at to balance (theoretically this would be \(\frac{\pi}{2}\) radians, but since the center of gravity is not exactly in the middle, it&#39;s slightly different.</p>

<p>Once I knew the error from the target angle, I designed a simple <a href="/posts/intro-to-control-part-one-pid">proportional-derivative</a> controller to keep the bot upright. While this worked, there are many improvements that could be made:</p>

<ul>
<li>The bot could automatically detect it&#39;s center of gravity</li>
<li>I could use <a href="https://en.wikipedia.org/wiki/Linear-quadratic_regulator">LQR</a> instead of PID</li>
<li>I could allow for turning/more complicated paths in addition to position holding</li>
<li>I could add some sort of remote control (Bluetooth, Wifi, RC, etc)</li>
</ul>

<h1>Conclusion</h1>

<p>This project was a lot of fun, and I was able to get it into a working state much quicker than I was expecting to - just 2 days. It&#39;s also given me a platform for experimenting with control systems in the future.</p>

      </div>

      <br>
      <!--
ooops, coronavirus happened, guess we're not doing this anymore :(
hopefully someday...
<p>If you're in NYC and want to meet up over lunch/coffee to chat about the future of technology, <a href="mailto:me@wesleyac.com">get in touch with me</a>.</p>
-->

      <br>
    </article>
  </main>
  <script async src="/mathjax/MathJax.js?config=TeX-MML-AM_CHTML"></script> 
</body>
</html>
